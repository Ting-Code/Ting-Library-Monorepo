<template>
  <div ref="graphRef" style="width: 300px; height: 300px"></div>
</template>

<script setup lang="ts">
  import { ref } from 'vue'
  import { Graph } from '@antv/x6'

  const graphRef = ref<HTMLDivElement | null>(null)
  const configJson = ref(
    '{  "cells": [    {      "shape": "edge",      "attrs": {        "line": {          "stroke": "#A2B1C3",          "targetMarker": {            "name": "block",            "width": 12,            "height": 8          }        }      },      "id": "2b1cd09b-4590-47af-8678-ce150f6dc6f2",      "zIndex": 0,      "source": {        "cell": "a5b4527b-fef8-4d22-bb39-a188c74c7c10",        "port": "2d63f9c2-5b25-4adc-8c3f-9af7043fe25b"      },      "target": {        "cell": "0fbf7c84-af5d-455a-b5f8-d3fe6af1ed91",        "port": "8ed89ef7-0981-4340-8719-4af712bc7fe7"      }    },    {      "position": {        "x": 180,        "y": 70      },      "size": {        "width": 66,        "height": 36      },      "attrs": {        "text": {          "text": "开始"        },        "body": {          "rx": 20,          "ry": 26        }      },      "visible": true,      "shape": "custom-rect",      "ports": {        "groups": {          "top": {            "position": "top",            "attrs": {              "circle": {                "r": 4,                "magnet": true,                "stroke": "#5F95FF",                "strokeWidth": 1,                "fill": "#fff",                "style": {                  "visibility": "hidden"                }              }            }          },          "right": {            "position": "right",            "attrs": {              "circle": {                "r": 4,                "magnet": true,                "stroke": "#5F95FF",                "strokeWidth": 1,                "fill": "#fff",                "style": {                  "visibility": "hidden"                }              }            }          },          "bottom": {            "position": "bottom",            "attrs": {              "circle": {                "r": 4,                "magnet": true,                "stroke": "#5F95FF",                "strokeWidth": 1,                "fill": "#fff",                "style": {                  "visibility": "hidden"                }              }            }          },          "left": {            "position": "left",            "attrs": {              "circle": {                "r": 4,                "magnet": true,                "stroke": "#5F95FF",                "strokeWidth": 1,                "fill": "#fff",                "style": {                  "visibility": "hidden"                }              }            }          }        },        "items": [          {            "group": "top",            "id": "2e59886c-be04-4ff0-ae68-707db37db30b"          },          {            "group": "right",            "id": "d8a3ea5e-22d9-4e75-8b79-d76477ab4882"          },          {            "group": "bottom",            "id": "2d63f9c2-5b25-4adc-8c3f-9af7043fe25b"          },          {            "group": "left",            "id": "6ca30391-087c-4185-a053-e38d0625fb4b"          }        ]      },      "id": "a5b4527b-fef8-4d22-bb39-a188c74c7c10",      "zIndex": 1    },    {      "position": {        "x": 180,        "y": 163      },      "size": {        "width": 66,        "height": 36      },      "attrs": {        "text": {          "text": "过程"        }      },      "visible": true,      "shape": "custom-rect",      "ports": {        "groups": {          "top": {            "position": "top",            "attrs": {              "circle": {                "r": 4,                "magnet": true,                "stroke": "#5F95FF",                "strokeWidth": 1,                "fill": "#fff",                "style": {                  "visibility": "hidden"                }              }            }          },          "right": {            "position": "right",            "attrs": {              "circle": {                "r": 4,                "magnet": true,                "stroke": "#5F95FF",                "strokeWidth": 1,                "fill": "#fff",                "style": {                  "visibility": "hidden"                }              }            }          },          "bottom": {            "position": "bottom",            "attrs": {              "circle": {                "r": 4,                "magnet": true,                "stroke": "#5F95FF",                "strokeWidth": 1,                "fill": "#fff",                "style": {                  "visibility": "hidden"                }              }            }          },          "left": {            "position": "left",            "attrs": {              "circle": {                "r": 4,                "magnet": true,                "stroke": "#5F95FF",                "strokeWidth": 1,                "fill": "#fff",                "style": {                  "visibility": "hidden"                }              }            }          }        },        "items": [          {            "group": "top",            "id": "8ed89ef7-0981-4340-8719-4af712bc7fe7"          },          {            "group": "right",            "id": "5a687b47-f001-4746-9349-289ca436518a"          },          {            "group": "bottom",            "id": "e4dc8c44-2bec-4391-92c8-dc3e8632af82"          },          {            "group": "left",            "id": "3eb1db75-e70c-456b-b7bd-1d5c20dc214a"          }        ]      },      "id": "0fbf7c84-af5d-455a-b5f8-d3fe6af1ed91",      "zIndex": 2    }  ]}'
  )

  onMounted(() => {
    const graph = new Graph({
      container: graphRef.value!
    })

    const config = JSON.parse(configJson.value)
    graph.fromJSON(config)
  })
</script>
